"use strict";(self.webpackChunk_hadim_jupyter_archive=self.webpackChunk_hadim_jupyter_archive||[]).push([[933],{933:(e,t,o)=>{o.r(t),o.d(t,{default:()=>w});var r=o(609),a=o(519),n=o(426),c=o(322),i=o(380),s=o(452),d=o(697),l=o(778),h=o(888);const m=new h.LabIcon({name:"jupyter-archive:archive",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16px" height="16px"><path d="M0 0h24v24H0z" fill="none"/><path class="jp-icon3" fill="black" d="M20.54 5.23l-1.39-1.68C18.88 3.21 18.47 3 18 3H6c-.47 0-.88.21-1.16.55L3.46 5.23C3.17 5.57 3 6.02 3 6.5V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6.5c0-.48-.17-.93-.46-1.27zM12 17.5L6.5 12H10v-2h4v2h3.5L12 17.5zM5.12 5l.81-1h12l.94 1H5.12z"/></svg>'}),u=new h.LabIcon({name:"jupyter-archive:unarchive",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16"><path d="M0 0h24v24H0z" fill="none"/><path class="jp-icon3" fill="black" d="M20.55 5.22l-1.39-1.68A1.51 1.51 0 0018 3H6c-.47 0-.88.21-1.15.55L3.46 5.22C3.17 5.57 3 6.01 3 6.5V19a2 2 0 002 2h14c1.1 0 2-.9 2-2V6.5c0-.49-.17-.93-.45-1.28zM12 9.5l5.5 5.5H14v2h-4v-2H6.5L12 9.5zM5.12 5l.82-1h12l.93 1H5.12z"/></svg>'});var p;function v(e,t,o,r){const n=i.ServerConnection.makeSettings().baseUrl;let c=a.URLExt.join(n,"directories",a.URLExt.encodeParts(e));""===e&&(c+="/");const s=new URL(c),d=()=>Math.random().toString(36).slice(2);s.searchParams.append("archiveToken",(20,(d()+d()+d()+d()).slice(0,20))),s.searchParams.append("archiveFormat",t),s.searchParams.append("followSymlinks",o),s.searchParams.append("downloadHidden",r);const l=document.cookie.match("\\b_xsrf=([^;]*)\\b");l&&s.searchParams.append("_xsrf",l[1]),c=s.toString();const h=window.chrome;if(h&&(h.webstore||h.runtime))window.open(c);else{const e=document.createElement("a");document.body.appendChild(e),e.setAttribute("href",c),e.setAttribute("download",""),e.click(),document.body.removeChild(e)}}!function(e){e.downloadArchive="filebrowser:download-archive",e.extractArchive="filebrowser:extract-archive",e.downloadArchiveCurrentFolder="filebrowser:download-archive-current-folder"}(p||(p={}));const w={id:"@hadim/jupyter-archive:archive",autoStart:!0,requires:[c.IFileBrowserFactory,n.ISettingRegistry],optional:[s.ITranslator],activate:(e,t,o,n)=>{const c=(null!=n?n:s.nullTranslator).load("jupyter_archive");console.log("JupyterLab extension jupyter-archive is activated!");const{commands:h}=e,{tracker:w}=t,f=[".zip",".tgz",".tar.gz",".tbz",".tbz2",".tar.bz",".tar.bz2",".txz",".tar.xz"];let g,x,b;const _=".jp-DirListing-content",y='.jp-DirListing-item[data-isdir="true"]',k=new l.Menu({commands:h});k.title.label=c.__("Download As"),k.title.icon=m;const C=new l.Menu({commands:h});let z,A;function L(t,o){t!==o&&(t&&o||(void 0!==o&&(z.dispose(),A.dispose()),t?(z=e.contextMenu.addItem({command:p.downloadArchive,selector:y,rank:10}),A=e.contextMenu.addItem({command:p.downloadArchiveCurrentFolder,selector:_,rank:3})):(z=e.contextMenu.addItem({selector:y,rank:10,type:"submenu",submenu:k}),A=e.contextMenu.addItem({selector:_,rank:3,type:"submenu",submenu:C}))),g=t)}C.title.label=c.__("Download Current Folder As"),C.title.icon=m,["zip","tar.bz2","tar.gz","tar.xz"].forEach((e=>{k.addItem({command:p.downloadArchive,args:{format:e}}),C.addItem({command:p.downloadArchiveCurrentFolder,args:{format:e}})})),o.load("@hadim/jupyter-archive:archive").then((e=>{e.changed.connect((e=>{L(e.get("format").composite,g),x=e.get("followSymlinks").composite,b=e.get("downloadHidden").composite})),L(e.get("format").composite,g),x=e.get("followSymlinks").composite,b=e.get("downloadHidden").composite})).catch((e=>{console.error(e),(0,r.showErrorMessage)("Fail to read settings for '@hadim/jupyter-archive:archive'",e)})),h.addCommand(p.downloadArchive,{execute:e=>{const t=w.currentWidget;t&&(0,d.each)(t.selectedItems(),(t=>{if("directory"===t.type){const o=e.format;v(t.path,f.indexOf("."+o)>=0?o:g,x,b)}}))},icon:e=>"format"in e?void 0:m,label:e=>{var t;const o=(null!==(t=e.format)&&void 0!==t?t:"").replace("."," ").toLocaleUpperCase();return o?c.__("%1 Archive",o):c.__("Download as an Archive")}}),h.addCommand(p.extractArchive,{execute:()=>{const e=w.currentWidget;e&&(0,d.each)(e.selectedItems(),(e=>{!async function(e){const t=i.ServerConnection.makeSettings(),o=t.baseUrl;let n=a.URLExt.join(o,"extract-archive",a.URLExt.encodeParts(e));const c=new URL(n),s=document.cookie.match("\\b_xsrf=([^;]*)\\b");s&&c.searchParams.append("_xsrf",s[1]),n=c.toString();const d=await i.ServerConnection.makeRequest(n,{method:"GET"},t);if(200!==d.status){const e=await d.json();throw(0,r.showErrorMessage)("Fail to extract the archive file",e.reason),new i.ServerConnection.ResponseError(d)}}(e.path)}))},icon:u,isVisible:()=>{const e=w.currentWidget;let t=!1;if(e){let o;try{o=e.selectedItems().next().value}catch(t){o=e.selectedItems().next()}if(o){const e=a.PathExt.basename(o.path),r=e.split(".");let n="";r.length>=2&&(n="."+r.splice(r.length-2,2).join(".")),t=f.indexOf(a.PathExt.extname(e))>=0||f.indexOf(n)>=0}}return t},label:c.__("Extract Archive")}),e.contextMenu.addItem({command:p.extractArchive,selector:'.jp-DirListing-item[data-isdir="false"]',rank:10}),h.addCommand(p.downloadArchiveCurrentFolder,{execute:e=>{const t=w.currentWidget;if(t){const o=e.format;v(t.model.path,f.indexOf("."+o)>=0?o:g,x,b)}},icon:e=>"format"in e?void 0:m,label:e=>{const t=(e.format||"").replace("."," ").toLocaleUpperCase();return t?c.__("%1 Archive",t):c.__("Download Current Folder as an Archive")}})}}}}]);