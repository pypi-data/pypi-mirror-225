import{j as e,e as i,r as D,U as b,D as $,s as S,V as z}from"./index-ff1743b2.js";import{p as O}from"./pluralize-1a9dd2e8.js";import{E as o}from"./context-d92d8d28.js";function M({progress:s=0,delay:t=0,duration:n=0,className:r}){return e.jsx("div",{className:i("w-full h-1 bg-neutral-30 overflow-hidden flex items-center rounded-lg my-1",r),children:e.jsx("div",{className:"transition-[width] h-full bg-success-500 rounded-lg",style:{width:`${s}%`,transitionDelay:`${t}ms`,transitionDuration:`${n}ms`}})})}const u=function({children:t,setRefTasksOverview:n,tasks:r}){const{models:c,taskCompleted:j,taskTotal:x,batchesTotal:p,batchesCompleted:m}=D.useMemo(()=>{const d=Object.entries(r),a=d.length;let l=0,w=0,T=0;return d.forEach(([q,{completed:N,total:y}])=>{l=N===y?l+1:l,w+=y,T+=N}),{models:d,taskCompleted:l,taskTotal:a,batchesTotal:w,batchesCompleted:T}},[r]);return e.jsx("div",{className:"text-prose",ref:n,children:t({models:c,completed:j,total:x,totalBatches:p,completedBatches:m})})};function P({className:s,headline:t,environment:n,planState:r,completed:c,total:j,updatedAt:x,updateType:p,completedBatches:m,totalBatches:d}){return e.jsx(v,{className:s,children:e.jsxs(k,{children:[e.jsxs(C,{children:[e.jsx(I,{children:e.jsx(A,{headline:t,environment:n,planState:r})}),e.jsxs(E,{children:[e.jsx(f,{completed:c,total:j,unit:"task"}),e.jsx(h,{}),e.jsx(f,{completed:m,total:d,unit:"batches"}),e.jsx(h,{}),e.jsx(R,{completed:m,total:d})]})]}),e.jsx(M,{progress:b(m,d)}),x!=null&&e.jsx(L,{updatedAt:x,updateType:p})]})})}function U({models:s,className:t,changes:n,showBatches:r=!0,showProgress:c=!0,showVirtualUpdate:j=!1}){const{changesAdded:x,changesRemoved:p,changesModifiedDirect:m,changesModifiedIndirect:d}=D.useMemo(()=>{const a=n==null?void 0:n.modified;return{changesAdded:(n==null?void 0:n.added)??[],changesRemoved:(n==null?void 0:n.removed)??[],changesModifiedMetadata:(a==null?void 0:a.metadata)??[],changesModifiedIndirect:((a==null?void 0:a.indirect)??[]).map(({model_name:l})=>l),changesModifiedDirect:((a==null?void 0:a.direct)??[]).map(({model_name:l})=>l)}},[n]);return e.jsx(v,{className:t,children:e.jsx(g,{models:s,children:([a,l])=>e.jsxs(k,{children:[e.jsxs(C,{children:[e.jsxs(I,{children:[l.interval!=null&&e.jsx(F,{start:l.interval[0],end:l.interval[1]}),e.jsx(V,{modelName:a,changeType:_({modelName:a,changesAdded:x,changesRemoved:p,changesModifiedDirect:m,changesModifiedIndirect:d})})]}),e.jsxs(E,{children:[r&&e.jsx(f,{completed:l.completed,total:l.total,unit:"batch"}),e.jsx(h,{}),c&&e.jsx(e.Fragment,{children:l.end==null||l.start==null?e.jsx(R,{total:l.total,completed:l.completed}):e.jsx(H,{start:l.start,end:l.end})}),j&&e.jsx("span",{className:"inline-block whitespace-nowrap font-bold ml-2",children:"Updated"})]})]}),c?e.jsx(M,{progress:b(l.completed,l.total)}):e.jsx($,{className:"my-1 border-neutral-200 opacity-50"})]})})})}function v({className:s,children:t}){return e.jsx("div",{className:i("my-3 mx-4 max-h-[50vh] overflow-auto scrollbar scrollbar--vertical scrollbar--horizontal",s),children:t})}function k({className:s,children:t}){return e.jsx("div",{className:i("px-4",s),children:t})}function g({className:s,models:t,children:n}){return e.jsx("ul",{className:i("bg-neutral-10 rounded-lg py-4 overflow-auto text-prose scrollbar scrollbar--vertical scrollbar--horizontal",s),children:t.map(([r,c])=>e.jsx("li",{className:"mb-2",children:n([r,c])},r))})}function C({className:s,children:t}){return e.jsx("div",{className:i("flex sm:justify-between sm:items-baseline text-xs",s),children:t})}function A({className:s,headline:t,environment:n,planState:r}){return e.jsxs("span",{className:i("flex items-center",s),children:[e.jsx("span",{className:"block whitespace-nowrap text-sm font-medium",children:t}),e.jsx("small",{className:"inline-block ml-1 px-2 py-[0.125rem] text-xs font-bold bg-neutral-10 rounded-md",children:n}),r!==S.Init&&e.jsxs(e.Fragment,{children:[e.jsx(h,{}),e.jsx("small",{className:"ml-1",children:r})]})]})}function I({className:s,children:t}){return e.jsx("div",{className:i("flex mr-6 w-full sm:w-auto overflow-hidden",s),children:t})}function E({className:s,children:t}){return e.jsx("div",{className:i("flex items-center",s),children:t})}function F({className:s,start:t,end:n}){return e.jsxs("span",{className:i("inline-block mr-2 whitespace-nowrap font-mono",s),children:[t," – ",n]})}function f({className:s,total:t,completed:n,unit:r}){return e.jsxs("span",{className:i("inline-block whitespace-nowrap",s),children:[n," of ",t," ",O(r,t)]})}function h({className:s}){return e.jsx("span",{className:i("inline-block mx-2",s),children:"|"})}function R({className:s,total:t,completed:n}){return e.jsxs("span",{className:i("inline-block whitespace-nowrap font-bold",s),children:[Math.ceil(b(n,t)),"%"]})}function H({className:s,start:t,end:n}){return e.jsx("span",{className:i("inline-block whitespace-nowrap font-bold",s),children:`${Math.floor((n-t)/6e4)}:${String(Math.ceil((n-t)/1e3%60)).padStart(2,"0")}`})}function L({updateType:s,updatedAt:t}){return e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsxs("small",{className:"text-xs",children:[e.jsx("b",{children:"Update Type:"}),e.jsx("span",{className:"inline-block ml-1",children:s})]}),e.jsxs("small",{className:"text-xs",children:[e.jsx("b",{children:"Last Update:"}),e.jsx("span",{className:"inline-block ml-1",children:z(new Date(t),"yyyy-mm-dd hh-mm-ss",!1)})]})]})}function V({className:s,modelName:t,changeType:n}){return e.jsx("span",{className:i("font-bold whitespace-nowrap",n===o.Add&&"text-success-600  dark:text-success-500",n===o.Remove&&"text-danger-500",n===o.Direct&&"text-secondary-500 dark:text-primary-500",n===o.Indirect&&"text-warning-500",n===o.Metadata&&"text-prose",s),children:t})}u.Block=v;u.Summary=P;u.Details=U;u.Task=k;u.Tasks=g;const K=u;function _({modelName:s,changesAdded:t,changesRemoved:n,changesModifiedDirect:r,changesModifiedIndirect:c}){return t.includes(s)?o.Add:n.includes(s)?o.Remove:r.includes(s)?o.Direct:c.includes(s)?o.Indirect:o.Metadata}export{K as T};
