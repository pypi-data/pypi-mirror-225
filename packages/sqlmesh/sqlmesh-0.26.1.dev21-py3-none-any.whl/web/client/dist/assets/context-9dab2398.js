import{a as S,b as $,r as h,a4 as B,j as G,a7 as b,a8 as P,q as R,a3 as p,a9 as C,a5 as y,z as H,aa as J,ab as K,ac as Q,ad as V,d as Z}from"./index-ff1743b2.js";const L=h.createContext({confirmation:void 0,showConfirmation:!1,activeRange:new Set,setActiveRange:()=>{},selectArtifactsInRange:()=>{},createDirectory:()=>{},createFile:()=>{},renameArtifact:()=>{},removeArtifacts:()=>{},removeArtifactWithConfirmation:()=>{},moveArtifacts:()=>{},setShowConfirmation:()=>{},setConfirmation:()=>{}});function ee({children:M}){const l=S(e=>e.project),T=S(e=>e.files),D=S(e=>e.setSelectedFile),F=S(e=>e.setFiles),d=$(e=>e.tab),I=$(e=>e.closeTab),[A,c]=h.useState(!1),[v,w]=h.useState(new Set),[E,g]=h.useState(),[O,N]=h.useState(!1);h.useEffect(()=>{N(B(E))},[E]),h.useEffect(()=>{D(d==null?void 0:d.file)},[d]);function X(e){w(o=>{const t=o.size-1,i=l.allArtifacts,u=Array.from(o),n=u[0],m=u[t],a=i.indexOf(e),f=n==null?0:i.indexOf(n),r=m==null?t:i.indexOf(m),k=a>f?f:a,U=a>r||a>f&&a<r?a:r;return new Set(i.slice(k,U+1))})}function z(e){if(A)return;c(!0);const o=b("new_directory");P(`${e.path}/${o}`,{}).then(s=>{if(R(s.ok)){console.warn([`Directory: ${e.path}`,s.detail]);return}e.addDirectory(new p(s,e)),e.open()}).catch(s=>{console.log(s)}).finally(()=>{c(!1)})}function Y(e,o=".py"){if(A)return;c(!0);const s=b("new_file",o);C(`${e.path}/${s}`,{content:""}).then(t=>{if(R(t.ok)){console.warn([`File: ${e.path}`,t.detail]);return}const i=new y(t,e);e.addFile(i),e.open(),D(i),F((l==null?void 0:l.allFiles)??[])}).catch(t=>{console.log(t)}).finally(()=>{c(!1)})}function q(e,o){if(A||H(o))return;c(!0);const s=e.name,t=e.path;e.rename(o.trim()),e instanceof p&&P(t,{new_path:e.path}).catch(i=>{console.log(i),e.rename(s)}).finally(()=>{c(!1),d!=null&&e.hasFile(d.file)&&D(d.file),F((l==null?void 0:l.allFiles)??[])}),e instanceof y&&C(t,{new_path:e.path}).then(i=>{e.update(i),T.set(e.path,e),T.delete(t)}).catch(i=>{console.log(i),e.rename(s)}).finally(()=>{c(!1),F((l==null?void 0:l.allFiles)??[])})}function x(e){if(A)return;c(!0);const o=Array.from(e),s=o.map(t=>t instanceof y?J(t.path):K(t.path));Promise.all(s).then(t=>{t.forEach((i,u)=>{var m,a;const n=o[u];n instanceof y&&(I(n),(m=n.parent)==null||m.removeFile(n)),n instanceof p&&(n.isNotEmpty&&Q(n).forEach(r=>{I(r)}),(a=n.parent)==null||a.removeDirectory(n))}),w(new Set),F((l==null?void 0:l.allFiles)??[])}).catch(t=>{console.log(t)}).finally(()=>{c(!1)})}function W(e){let o={headline:`Removing ${e instanceof p?"Directory":"File"}`,description:`Are you sure you want to remove the ${e instanceof p?"directory":"file"} "${e.name}"?`,yesText:"Yes, Remove",noText:"No, Cancel",action:()=>{e instanceof p&&e.parent!=null&&x(new Set([e])),e instanceof y&&e.parent!=null&&x(new Set([e]))}};v.has(e)&&(o={headline:"Removing Selected Files/Directories",description:`Are you sure you want to remove ${v.size} items?`,yesText:"Yes, Remove",noText:"No, Cancel",details:Array.from(v).map(s=>s.path),action:()=>{x(v)}}),g(o)}function _(e,o,s=!1){if(A)return;c(!0);const t=[],i=[],u=[];if(e.forEach(n=>{const m=o.containsName(n.name),a=n.path;if(m&&R(s))return u.push(n);s&&n.rename(n.copyName());const f=V.toPath(o.path,n.name);n instanceof p&&(t.push(()=>{var r;(r=n.parent)==null||r.removeDirectory(n),o.addDirectory(n)}),i.push(P(a,{new_path:f})),n.allArtifacts.forEach(r=>e.delete(r))),n instanceof y&&(t.push(()=>{var r;(r=n.parent)==null||r.removeFile(n),o.addFile(n)}),i.push(C(a,{new_path:f})))}),Z(u)){g({headline:"Moving Duplicates",description:"All duplicated names will be renamed!",yesText:"Yes, Rename",noText:"No, Cancel",details:u.map(n=>n.path),action:()=>{_(e,o,!0)}});return}Promise.all(i).then(n=>{n.forEach((m,a)=>{var f;return(f=t[a])==null?void 0:f.call(t)})}).catch(n=>{console.log(n)}).finally(()=>{c(!1),w(new Set),F((l==null?void 0:l.allFiles)??[])})}return G.jsx(L.Provider,{value:{confirmation:E,showConfirmation:O,activeRange:v,createDirectory:z,createFile:Y,renameArtifact:q,removeArtifacts:x,removeArtifactWithConfirmation:W,moveArtifacts:_,selectArtifactsInRange:X,setConfirmation:g,setShowConfirmation:N,setActiveRange(e){w(()=>new Set(l.allArtifacts.filter(o=>e.has(o))))}},children:M})}function ne(){return h.useContext(L)}export{L as FileExplorerContext,ee as default,ne as useFileExplorer};
