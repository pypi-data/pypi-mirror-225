"use strict";(self.webpackChunk_dagster_io_app_oss=self.webpackChunk_dagster_io_app_oss||[]).push([[174],{17869:function(n,e,t){t.d(e,{BY:function(){return j},OK:function(){return v},gA:function(){return C},mQ:function(){return b},xv:function(){return m}});var r,i,o,c,s=t(59740),l=t(33028),u=t(71171),a=t(78193),d=t(60319),x=t(69059),p=t(29427),f=t(52714),h=t(35936),y=["selectedTabId","children","onChange","size"],m=function(n){var e=n.selected,t=n.disabled;return{role:"tab",tabIndex:t?-1:0,"aria-disabled":t,"aria-expanded":e,"aria-selected":e}},j=function(n){var e=n.title,t=n.count,r=n.icon;return(0,h.jsxs)(h.Fragment,{children:[e,r,void 0!==t?(0,h.jsx)(g,{children:"indeterminate"===t?"\u2013":t}):null]})},g=d.ZP.div(r||(r=(0,u.Z)(["\n  display: inline;\n  font-family: ",";\n  font-size: 14px;\n  font-weight: 500;\n  letter-spacing: -0.02%;\n  padding: 0 4px;\n  color: ",";\n  background: ",";\n"])),f.b.monospace,x.w.Gray900,x.w.Gray100),C=(0,d.iv)(i||(i=(0,u.Z)(["\n  background: none;\n  border: none;\n  font-size: 14px;\n  line-height: 20px;\n  font-weight: 600;\n  padding: ",";\n  box-shadow: "," 0 -2px 0 inset;\n  display: flex;\n  align-items: center;\n  cursor: pointer;\n  gap: 6px;\n\n  &,\n  & a {\n    cursor: pointer;\n    user-select: none;\n    color: ",";\n  }\n\n  & "," {\n    background: ",";\n  }\n\n  /* Focus outline only when using keyboard, not when focusing via mouse. */\n  &:focus {\n    outline: none !important;\n    box-shadow: ","\n      0 -2px 0 inset;\n  }\n\n  &:hover {\n    &,\n    a {\n      text-decoration: none;\n      color: ",";\n    }\n    "," {\n      color: ",";\n    }\n  }\n"])),(function(n){return"small"===n.$size?"10px 0":"16px 0"}),(function(n){return n.selected?x.w.Blue500:"transparent"}),(function(n){var e=n.selected,t=n.disabled;return e?x.w.Blue500:t?x.w.Gray300:x.w.Gray700}),p.a1,(function(n){var e=n.selected,t=n.disabled;return e?x.w.Blue500:t?x.w.Gray300:""}),(function(n){var e=n.selected,t=n.disabled;return e?x.w.Blue500:t?"transparent":x.w.Blue200}),(function(n){var e=n.selected,t=n.disabled;return e?x.w.Blue700:t?x.w.Gray300:x.w.Blue700}),p.a1,(function(n){var e=n.selected,t=n.disabled;return e?x.w.Blue700:t?x.w.Gray300:""})),v=(0,d.ZP)((function(n){var e=m(n),t=j(n),r="string"===typeof n.title?n.title:void 0;return(0,h.jsx)("button",(0,l.Z)((0,l.Z)((0,l.Z)({},n),e),{},{title:r,type:"button",children:t}))}))(o||(o=(0,u.Z)(["\n  ","\n"])),C),b=(0,d.ZP)((function(n){var e=n.selectedTabId,t=n.children,r=n.onChange,i=n.size,o=void 0===i?"large":i,c=(0,s.Z)(n,y);return(0,h.jsx)("div",(0,l.Z)((0,l.Z)({},c),{},{role:"tablist",children:a.Children.map(t,(function(n){return n?a.cloneElement(n,(0,l.Z)({selected:n.props.selected||n.props.id===e,$size:o},r?{onClick:function(){return r(n.props.id)}}:{})):null}))}))}))(c||(c=(0,u.Z)(["\n  display: flex;\n  gap: 16px;\n  font-size: ",";\n  line-height: ",";\n  font-weight: 600;\n"])),(function(n){return"small"===n.size?"12px":"14px"}),(function(n){return"small"===n.size?"16px":"20px"}))},78174:function(n,e,t){t.r(e),t.d(e,{CONCURRENCY_LIMIT_FRAGMENT:function(){return W},ConcurrencyLimits:function(){return G},FREE_CONCURRENCY_SLOTS_FOR_RUN_MUTATION:function(){return nn},INSTANCE_CONCURRENCY_LIMITS_QUERY:function(){return X}});var r,i,o,c,s,l=t(71171),u=t(32723),a=t(34795),d=t(96234),x=t(90239),p=t(15541),f=t(31623),h=t(40302),y=t(83796),m=t(19427),j=t(38527),g=t(99600),C=t(34943),v=t(85049),b=t(29427),Z=t(58760),w=t(36318),k=t(48439),I=t(15888),R=t(72979),S=t(16854),_=t(27589),N=t(78193),T=t(50032),E=t(52232),K=t(85163),F=t(72885),O=t(59298),z=t(61365),L=t(25271),P=t(44355),$=t(91870),A=t(21372),B=t(70897),D=t(35936),Y=N.memo((function(){(0,z.Px)(),(0,L.j)("Concurrency");var n=(0,K.gV)().flagInstanceConcurrencyLimits,e=N.useContext(A.N).pageTitle,t=(0,x.a)(X,{notifyOnNetworkStatusChange:!0}),r=(0,O.C4)(t,O.dT),i=t.data,o=i?n?(0,D.jsx)(G,{instanceConfig:i.instance.info,limits:i.instance.concurrencyLimits,hasSupport:i.instance.supportsConcurrencyLimits,refetch:t.refetch}):(0,D.jsx)(T.l_,{to:"/config"}):(0,D.jsx)(h.x,{padding:{vertical:64},children:(0,D.jsx)(y.$,{purpose:"section"})});return(0,D.jsxs)(m.T,{children:[(0,D.jsx)(j.m,{title:(0,D.jsx)(g.X6,{children:e}),tabs:(0,D.jsx)(B.Z,{tab:"concurrency",refreshState:r})}),o]})}));e.default=Y;var G=function(n){var e=n.instanceConfig,t=n.hasSupport,r=n.limits,i=n.refetch,o=N.useState(),c=(0,d.Z)(o,2),s=c[0],l=c[1],u=N.useState(void 0),a=(0,d.Z)(u,2),x=a[0],p=a[1],f=N.useState(void 0),y=(0,d.Z)(f,2),m=y[0],j=y[1],g=N.useCallback((function(){p(void 0),j(void 0)}),[j,p]),I=Object.fromEntries(r.map((function(n){return[n.concurrencyKey,n.slotCount]}))),R=function(){l({actionType:"add"})},S=function(n){l({actionType:"edit",concurrencyKey:n,concurrencyLimit:I[n]})},_=function(n){l({actionType:"delete",concurrencyKey:n})};return!t&&e&&e.includes("SqliteEventLogStorage")?(0,D.jsx)(h.x,{margin:24,children:(0,D.jsx)(C.t,{icon:"error",title:"No concurrency support",description:"This instance does not support global concurrency limits. You will need to configure a different storage implementation (e.g. Postgres/MySQL) to use this feature."})}):!1===t?(0,D.jsx)(h.x,{margin:24,children:(0,D.jsx)(C.t,{icon:"error",title:"No concurrency support",description:"This instance does not currently support global concurrency limits. You may need to run `dagster instance migrate` to add the necessary tables to your dagster storage to support this feature."})}):(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)(h.x,{children:[(0,D.jsx)(h.x,{flex:{justifyContent:"flex-end"},padding:16,children:(0,D.jsx)(v.zx,{intent:"primary",icon:(0,D.jsx)(b.JO,{name:"add_circle"}),onClick:function(){return R()},children:"Add concurrency limit"})}),0===r.length?(0,D.jsx)(C.t,{icon:"error",title:"No concurrency limits",description:(0,D.jsxs)(D.Fragment,{children:["No concurrency limits have been configured for this instance.\xa0",(0,D.jsx)(Z.Z,{onClick:function(){return R()},children:"Add a concurrency limit"}),"."]})}):(0,D.jsxs)(w.i,{children:[(0,D.jsx)("thead",{children:(0,D.jsxs)("tr",{children:[(0,D.jsx)("th",{style:{width:"260px"},children:"Concurrency key"}),(0,D.jsx)("th",{style:{width:"20%"},children:"Occupied slots"}),(0,D.jsx)("th",{style:{width:"20%"},children:"Total slots"}),(0,D.jsx)("th",{children:"Active runs"}),(0,D.jsx)("th",{})]})}),(0,D.jsx)("tbody",{children:r.map((function(n){return(0,D.jsxs)("tr",{children:[(0,D.jsx)("td",{children:n.concurrencyKey}),(0,D.jsx)("td",{children:n.activeSlotCount}),(0,D.jsx)("td",{children:n.slotCount}),(0,D.jsx)("td",{children:0===n.activeRunIds.length?(0,D.jsx)(D.Fragment,{children:"\u2014"}):(0,D.jsx)(k.V,{intent:"primary",interactive:!0,children:(0,D.jsxs)(Z.Z,{onClick:function(){j(n.concurrencyKey),p(n.activeRunIds)},children:[n.activeRunIds.length," ",1===n.activeRunIds.length?"run":"runs"]})})}),(0,D.jsx)("td",{children:(0,D.jsx)(U,{concurrencyKey:n.concurrencyKey,onEdit:S,onDelete:_})})]},n.concurrencyKey)}))})]})]}),(0,D.jsx)(Q,{open:"add"===(null===s||void 0===s?void 0:s.actionType),onClose:function(){return l(void 0)},onComplete:i}),(0,D.jsx)(J,{concurrencyKey:s&&"delete"===s.actionType?s.concurrencyKey:"",open:"delete"===(null===s||void 0===s?void 0:s.actionType),onClose:function(){return l(void 0)},onComplete:i}),(0,D.jsx)(V,{open:"edit"===(null===s||void 0===s?void 0:s.actionType),onClose:function(){return l(void 0)},onComplete:i,concurrencyKey:"edit"===(null===s||void 0===s?void 0:s.actionType)?s.concurrencyKey:""}),(0,D.jsx)(M,{title:(0,D.jsxs)("span",{children:["Active runs for ",(0,D.jsx)("strong",{children:m})]}),onClose:g,runIds:x})]})},U=function(n){var e=n.concurrencyKey,t=n.onDelete,r=n.onEdit;return(0,D.jsx)(I.J,{content:(0,D.jsxs)(R.v2,{children:[(0,D.jsx)(R.sN,{icon:"edit",text:"Edit",onClick:function(){return r(e)}}),(0,D.jsx)(R.sN,{icon:"delete",intent:"danger",text:"Delete",onClick:function(){return t(e)}})]}),position:"bottom-left",children:(0,D.jsx)(v.zx,{icon:(0,D.jsx)(b.JO,{name:"expand_more"})})})},q=function(n){if(!n)return!1;var e=parseInt(n);return!isNaN(e)&&(String(e)===n.trim()&&(e>0&&e<1e3))},Q=function(n){var e=n.open,t=n.onClose,r=n.onComplete,i=N.useState(!1),o=(0,d.Z)(i,2),c=o[0],s=o[1],l=N.useState(""),x=(0,d.Z)(l,2),f=x[0],y=x[1],m=N.useState(""),j=(0,d.Z)(m,2),g=j[0],C=j[1];N.useEffect((function(){y(""),C("")}),[e]);var b=(0,p.D)(H),Z=(0,d.Z)(b,1)[0],w=function(){var n=(0,a.Z)((0,u.Z)().mark((function n(){return(0,u.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s(!0),n.next=3,Z({variables:{concurrencyKey:g,limit:parseInt(f.trim())}});case 3:s(!1),r(),t();case 6:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();return(0,D.jsxs)(S.Vq,{isOpen:e,title:"Add concurrency limit",onClose:t,children:[(0,D.jsxs)(S.a7,{children:[(0,D.jsx)(h.x,{margin:{bottom:4},children:"Concurrency key:"}),(0,D.jsx)(h.x,{margin:{bottom:16},children:(0,D.jsx)(_.oi,{value:g||"",onChange:function(n){return C(n.target.value)},placeholder:"Concurrency key"})}),(0,D.jsx)(h.x,{margin:{bottom:4},children:"Concurrency limit (1-1000):"}),(0,D.jsx)(h.x,{children:(0,D.jsx)(_.oi,{value:f||"",onChange:function(n){return y(n.target.value)},placeholder:"1 - 1000"})})]}),(0,D.jsxs)(S.cN,{children:[(0,D.jsx)(v.zx,{intent:"none",onClick:t,children:"Cancel"}),(0,D.jsx)(v.zx,{intent:"primary",onClick:w,disabled:!q(f.trim())||!g||c,children:c?"Adding...":"Add limit"})]})]})},V=function(n){var e=n.concurrencyKey,t=n.open,r=n.onClose,i=n.onComplete,o=N.useState(!1),c=(0,d.Z)(o,2),s=c[0],l=c[1],x=N.useState(""),f=(0,d.Z)(x,2),y=f[0],m=f[1];N.useEffect((function(){m("")}),[t]);var j=(0,p.D)(H),C=(0,d.Z)(j,1)[0],b=function(){var n=(0,a.Z)((0,u.Z)().mark((function n(){return(0,u.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return l(!0),n.next=3,C({variables:{concurrencyKey:e,limit:parseInt(y.trim())}});case 3:l(!1),i(),r();case 6:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),Z=(0,D.jsxs)(D.Fragment,{children:["Edit ",(0,D.jsx)(g.fv,{children:e})]});return(0,D.jsxs)(S.Vq,{isOpen:t,title:Z,onClose:r,children:[(0,D.jsxs)(S.a7,{children:[(0,D.jsx)(h.x,{margin:{bottom:4},children:"Concurrency key:"}),(0,D.jsx)(h.x,{margin:{bottom:16},children:(0,D.jsx)("strong",{children:e})}),(0,D.jsx)(h.x,{margin:{bottom:4},children:"Concurrency limit (1-1000):"}),(0,D.jsx)(h.x,{children:(0,D.jsx)(_.oi,{value:y||"",onChange:function(n){return m(n.target.value)},placeholder:"1 - 1000"})})]}),(0,D.jsxs)(S.cN,{children:[(0,D.jsx)(v.zx,{intent:"none",onClick:r,children:"Close"}),s?(0,D.jsx)(v.zx,{intent:"primary",disabled:!0,children:"Updating..."}):(0,D.jsx)(v.zx,{intent:"primary",onClick:b,disabled:!q(y.trim()),children:"Update limit"})]})]})},J=function(n){var e=n.concurrencyKey,t=n.open,r=n.onClose,i=n.onComplete,o=N.useState(!1),c=(0,d.Z)(o,2),s=c[0],l=c[1],x=(0,p.D)(H),f=(0,d.Z)(x,1)[0],h=function(){var n=(0,a.Z)((0,u.Z)().mark((function n(){return(0,u.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return l(!0),n.next=3,f({variables:{concurrencyKey:e,limit:0}});case 3:l(!1),i(),r();case 6:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),y=(0,D.jsxs)(D.Fragment,{children:["Delete ",(0,D.jsx)(g.fv,{children:e})]});return(0,D.jsxs)(S.Vq,{isOpen:t,title:y,onClose:r,children:[(0,D.jsxs)(S.a7,{children:["Delete concurrency limit\xa0",(0,D.jsx)("strong",{children:e}),"?"]}),(0,D.jsxs)(S.cN,{children:[(0,D.jsx)(v.zx,{intent:"none",onClick:r,children:"Close"}),s?(0,D.jsx)(v.zx,{intent:"danger",disabled:!0,children:"Deleting..."}):(0,D.jsx)(v.zx,{intent:"danger",onClick:h,children:"Delete limit"})]})]})},M=function(n){var e=n.runIds,t=n.onClose,r=n.title,i=(0,x.a)(en,{variables:{limit:25,filter:{runIds:e||[]}},skip:!e||!e.length}).data,o=(0,p.D)(nn),c=(0,d.Z)(o,1)[0],s=N.useCallback((function(n){return P.cv.has(n.status)?[(0,D.jsx)(R.sN,{icon:"status",text:"Free concurrency slots for run",onClick:(0,a.Z)((0,u.Z)().mark((function e(){var r,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c({variables:{runId:n.id}});case 2:if(i=e.sent,null===(r=i.data)||void 0===r||!r.freeConcurrencySlotsForRun){e.next=6;break}return e.next=6,(0,E.B7)({intent:"success",icon:"copy_to_clipboard_done",message:"Freed concurrency slots"});case 6:t();case 7:case"end":return e.stop()}}),e)})))},"free-concurrency-slots")]:[]}),[c,t]);return(0,D.jsxs)(S.Vq,{isOpen:!!e&&e.length>0,title:r,onClose:t,style:{width:"60%",minWidth:"400px"},children:[(0,D.jsx)(h.x,{padding:{vertical:16},children:i?"Runs"===i.pipelineRunsOrError.__typename?(0,D.jsx)($.AL,{runs:i.pipelineRunsOrError.results,additionalActionsForRun:s}):(0,D.jsxs)(h.x,{padding:{vertical:64},children:[(0,D.jsx)(C.t,{icon:"error",title:"Query Error",description:"PythonError"===i.pipelineRunsOrError.__typename?i.pipelineRunsOrError.message:"There was a problem querying for these runs."}),";"]}):(0,D.jsx)(h.x,{padding:{vertical:64},children:(0,D.jsx)(y.$,{purpose:"section"})})}),(0,D.jsx)(S.cN,{children:(0,D.jsx)(v.zx,{intent:"none",onClick:t,children:"Close"})})]})},W=(0,f.Ps)(r||(r=(0,l.Z)(["\n  fragment ConcurrencyLimitFragment on ConcurrencyKeyInfo {\n    concurrencyKey\n    slotCount\n    activeRunIds\n    activeSlotCount\n  }\n"]))),X=(0,f.Ps)(i||(i=(0,l.Z)(["\n  query InstanceConcurrencyLimitsQuery {\n    instance {\n      id\n      info\n      supportsConcurrencyLimits\n      concurrencyLimits {\n        ...ConcurrencyLimitFragment\n      }\n    }\n  }\n\n  ","\n"])),W),H=(0,f.Ps)(o||(o=(0,l.Z)(["\n  mutation SetConcurrencyLimit($concurrencyKey: String!, $limit: Int!) {\n    setConcurrencyLimit(concurrencyKey: $concurrencyKey, limit: $limit)\n  }\n"]))),nn=(0,f.Ps)(c||(c=(0,l.Z)(["\n  mutation FreeConcurrencySlotsForRun($runId: String!) {\n    freeConcurrencySlotsForRun(runId: $runId)\n  }\n"]))),en=(0,f.Ps)(s||(s=(0,l.Z)(["\n  query RunsForConcurrencyKeyQuery($filter: RunsFilter, $limit: Int) {\n    pipelineRunsOrError(filter: $filter, limit: $limit) {\n      ... on Runs {\n        results {\n          id\n          ... on PipelineRun {\n            ...RunTableRunFragment\n          }\n        }\n      }\n      ... on PythonError {\n        ...PythonErrorFragment\n      }\n    }\n  }\n\n  ","\n  ","\n"])),$.ZZ,F.B)},70897:function(n,e,t){t.d(e,{Z:function(){return C}});var r=t(40302),i=t(17869),o=t(78193),c=t(85163),s=t(59298),l=t(29427),u=t(69059),a=t(81935),d=t(74137),x=t(35936),p=o.memo((function(){var n=o.useContext(a.Z).daemons;return n?(0,x.jsx)(d.a,{content:n.content,position:"bottom",modifiers:{offset:{enabled:!0,options:{offset:[0,28]}}},children:(0,x.jsx)(l.JO,{name:"warning",color:u.w.Yellow500})}):null})),f=t(34191),h=t(83796),y=o.memo((function(n){var e=n.placeholder,t=o.useContext(a.Z).codeLocations;return t?"spinner"===t.type?(0,x.jsx)(f.u,{content:t.content,placement:"bottom",children:(0,x.jsx)(h.$,{purpose:"body-text",fillColor:u.w.Gray300})}):(0,x.jsx)(d.a,{content:t.content,position:"bottom",modifiers:{offset:{enabled:!0,options:{offset:[0,28]}}},children:(0,x.jsx)(l.JO,{name:"warning",color:u.w.Yellow500})}):e?(0,x.jsx)("div",{style:{width:"16px"}}):null})),m=t(3431),j=t(21372),g=t(65534),C=function(n){var e=n.refreshState,t=n.tab,l=o.useContext(j.N).healthTitle,u=(0,g._)(),a=(0,c.gV)().flagInstanceConcurrencyLimits;return(0,x.jsxs)(r.x,{flex:{direction:"row",justifyContent:"space-between",alignItems:"flex-end"},children:[(0,x.jsxs)(i.mQ,{selectedTabId:t,children:[(0,x.jsx)(m.f,{id:"locations",title:"Code locations",to:"/locations",icon:(0,x.jsx)(y,{placeholder:!1})}),(0,x.jsx)(m.f,{id:"health",title:l,to:"/health",icon:(0,x.jsx)(p,{})}),u&&a?(0,x.jsx)(m.f,{id:"concurrency",title:"Concurrency limits",to:"/concurrency"}):null,u?(0,x.jsx)(m.f,{id:"config",title:"Configuration",to:"/config"}):null]}),e?(0,x.jsx)(r.x,{padding:{bottom:8},children:(0,x.jsx)(s.xi,{refreshState:e})}):null]})}},3431:function(n,e,t){t.d(e,{f:function(){return x}});var r,i=t(33028),o=t(59740),c=t(71171),s=t(17869),l=(t(78193),t(97412)),u=t(60319),a=t(35936),d=["to","title","disabled"],x=(0,u.ZP)((function(n){var e=n.to,t=n.title,r=n.disabled,c=(0,o.Z)(n,d),u=(0,s.xv)(n),x=(0,s.BY)(n),p="string"===typeof t?t:void 0;return(0,a.jsx)(l.rU,(0,i.Z)((0,i.Z)((0,i.Z)({to:r?"#":e,title:p},u),c),{},{children:x}))}))(r||(r=(0,c.Z)(["\n  ","\n"])),s.gA)}}]);
//# sourceMappingURL=174.64b6f1ca.chunk.js.map