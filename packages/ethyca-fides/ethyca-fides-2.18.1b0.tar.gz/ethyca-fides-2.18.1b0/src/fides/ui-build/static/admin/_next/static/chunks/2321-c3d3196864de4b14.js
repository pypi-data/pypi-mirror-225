(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2321],{44845:function(e,t,n){"use strict";var r=n(90849),s=n(90089),i=n(32751),a=n(5008),o=n(29549),c=n(24246),u=["search","onChange","withIcon","onClear","placeholder"];function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.Z=function(e){var t=e.search,n=e.onChange,r=e.withIcon,l=e.onClear,f=e.placeholder,m=(0,s.Z)(e,u);return(0,c.jsxs)(i.BZ,{size:"sm",minWidth:"308px",children:[r?(0,c.jsx)(i.Z8,{pointerEvents:"none",children:(0,c.jsx)(a.PT,{color:"gray.300",w:"17px",h:"17px"})}):null,(0,c.jsx)(i.II,d({autoComplete:"off",type:"search",minWidth:200,size:"sm",borderRadius:"md",value:t,name:"search",onChange:function(e){return n(e.target.value)},placeholder:f||""},m)),l?(0,c.jsx)(i.xH,{children:(0,c.jsx)(o.zx,{borderLeftRadius:0,height:"95%",right:"14px",flexShrink:0,fontWeight:"light",size:"sm",onClick:l,children:"Clear"})}):null]})}},88486:function(e,t,n){"use strict";n.d(t,{Gt:function(){return f},eB:function(){return m},oI:function(){return d}});var r=n(34090),s=n(27378),i=n(6848),a=n(55447),o=n(30691),c=n(24246),u=(0,s.createRef)(),l=(0,s.createRef)(),d=function(){var e=(0,i.T)(),t=(0,i.C)(o.DB),n=(0,s.useCallback)((function(){l.current=void 0,u.current=void 0}),[]),r=(0,s.useCallback)((function(){e((0,o.Mr)()),l.current&&(l.current(!0),n())}),[e,n]),a=(0,s.useCallback)((function(){e((0,o.Mr)()),l.current&&(l.current(!1),n())}),[e,n]);return{attemptAction:(0,s.useCallback)((function(){return t?(e((0,o.h7)()),u.current||(u.current=new Promise((function(e){l.current=e}))),u.current):Promise.resolve(!0)}),[t,e]),onConfirm:r,onClose:a}},f=function(e){var t=e.id,n=e.name,a=(0,r.u6)().dirty,c=(0,i.T)();return(0,s.useEffect)((function(){return c((0,o.Zu)({id:t,name:n})),function(){c((0,o.dz)({id:t}))}}),[c,t,n]),(0,s.useEffect)((function(){c((0,o.$p)({id:t,isDirty:a}))}),[a,c,t]),null},m=function(){var e=d(),t=e.onConfirm,n=e.onClose,r=(0,i.C)(o.uv);return(0,c.jsx)(a.Z,{isOpen:r,onClose:n,onConfirm:t,title:"Unsaved Changes",message:"You have unsaved changes"})}},89348:function(e,t,n){"use strict";n.d(t,{q:function(){return R}});var r=n(62332),s=n(27378),i=n(90849),a=n(55732),o=n(97865),c=n(34707),u=n.n(c),l=n(70409),d=n(21084),f=n(34896),m=n(30794),p=n(29549),y=n(78624),h=n(88486),x=n(55232),j=n(40240),v=n(96156),g=n(34090),b=n(24246),w=function(e){var t=e.systems,n=e.dataFlows,r=e.onDataFlowSystemChange,s=(0,g.u6)().setFieldValue,i=n.map((function(e){return e.fides_key}));return(0,b.jsxs)(j.iA,{size:"sm","data-testid":"assign-systems-delete-table",children:[(0,b.jsx)(j.hr,{children:(0,b.jsxs)(j.Tr,{children:[(0,b.jsx)(j.Th,{children:"System"}),(0,b.jsx)(j.Th,{})]})}),(0,b.jsx)(j.p3,{children:t.filter((function(e){return i.includes(e.fides_key)})).map((function(e){return(0,b.jsxs)(j.Tr,{_hover:{bg:"gray.50"},"data-testid":"row-".concat(e.fides_key),children:[(0,b.jsx)(j.Td,{children:(0,b.jsx)(f.xv,{fontSize:"xs",lineHeight:4,fontWeight:"medium",children:e.name})}),(0,b.jsx)(j.Td,{textAlign:"end",children:(0,b.jsx)(p.hU,{background:"gray.50","aria-label":"Unassign data flow from system",icon:(0,b.jsx)(v.l,{}),variant:"outline",size:"sm",onClick:function(){return function(e){var t=n.filter((function(t){return t.fides_key!==e.fides_key}));s("dataFlowSystems",t),r(t)}(e)},"data-testid":"unassign-btn"})})]},e.fides_key)}))})]})},k=n(60530),C=n(92975),O=n(62709),S=n(44845),_=n(13861),D=n(73679),P=function(e){var t=e.allSystems,n=e.dataFlowSystems,r=e.onChange,s=e.flowType,i=(0,g.u6)().setFieldValue,a=function(e){if(!!n.find((function(t){return t.fides_key===e.fides_key}))){var t=n.filter((function(t){return t.fides_key!==e.fides_key}));i("dataFlowSystems",t),r(t)}else{var s=[].concat((0,D.Z)(n),[{fides_key:e.fides_key,type:"system"}]);i("dataFlowSystems",s),r(s)}};return(0,b.jsx)(f.xu,{overflowY:"auto",maxHeight:"300px",children:(0,b.jsxs)(j.iA,{size:"sm","data-testid":"assign-systems-table",maxHeight:"50vh",overflowY:"scroll",children:[(0,b.jsx)(j.hr,{position:"sticky",top:0,background:"white",zIndex:1,children:(0,b.jsxs)(j.Tr,{children:[(0,b.jsx)(j.Th,{children:"System"}),(0,b.jsxs)(j.Th,{textAlign:"right",children:["Set as ",s]})]})}),(0,b.jsx)(j.p3,{children:t.map((function(e){var t=!!n.find((function(t){return t.fides_key===e.fides_key}));return(0,b.jsxs)(j.Tr,{_hover:{bg:"gray.50"},"data-testid":"row-".concat(e.fides_key),children:[(0,b.jsx)(j.Td,{children:(0,b.jsx)(f.xv,{fontSize:"xs",lineHeight:4,fontWeight:"medium",children:e.name})}),(0,b.jsx)(j.Td,{textAlign:"right",children:(0,b.jsx)(O.r,{isChecked:t,onChange:function(){return a(e)},"data-testid":"assign-switch"})})]},e.fides_key)}))})]})})},F=function(e){var t=e.currentSystem,n=e.systems,r=e.isOpen,i=e.onClose,o=e.dataFlowSystems,c=e.onDataFlowSystemChange,l=e.flowType,d=(0,g.u6)().setFieldValue,m=(0,s.useState)(""),y=m[0],h=m[1],x=(0,s.useState)(o),j=x[0],v=x[1],w=function(){var e=(0,a.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c(j),i();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),D=0===n.length,F=(0,s.useMemo)((function(){return n?n.filter((function(e){return e.fides_key!==t.fides_key})).filter((function(e){return(0,_.R)(e,y)})):[]}),[n,t.fides_key,y]),Z=(0,s.useMemo)((function(){var e=new Set(j.map((function(e){return e.fides_key})));return F.every((function(t){return e.has(t.fides_key)}))}),[F,j]);return(0,b.jsxs)(k.u_,{isOpen:r,onClose:i,size:"2xl",isCentered:!0,children:[(0,b.jsx)(k.ZA,{}),(0,b.jsxs)(k.hz,{p:8,"data-testid":"confirmation-modal",children:[(0,b.jsxs)(k.xB,{fontWeight:"medium",display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,b.jsxs)(f.xv,{fontSize:"2xl",lineHeight:8,fontWeight:"semibold",children:["Configure ",l.toLocaleLowerCase()," systems"]}),(0,b.jsxs)(f.Ct,{bg:"green.500",color:"white",px:1,children:["Assigned to ",j.length," systems"]})]}),(0,b.jsx)(k.fe,{"data-testid":"assign-systems-modal-body",children:D?(0,b.jsx)(f.xv,{children:"No systems found"}):(0,b.jsxs)(f.Kq,{spacing:4,children:[(0,b.jsxs)(f.kC,{justifyContent:"space-between",children:[(0,b.jsx)(f.xv,{fontSize:"sm",flexGrow:1,fontWeight:"medium",children:"Add or remove destination systems from your data map"}),(0,b.jsx)(f.xu,{children:(0,b.jsxs)(C.NI,{display:"flex",alignItems:"center",children:[(0,b.jsx)(C.lX,{fontSize:"sm",htmlFor:"assign-all-systems",mb:"0",children:"Assign all systems"}),(0,b.jsx)(O.r,{size:"sm",id:"assign-all-systems",isChecked:Z,onChange:function(e){if(e.target.checked&&n){var t=F.map((function(e){return{fides_key:e.fides_key,type:"system"}}));d("dataFlowSystems",t),v(t)}else v([])},"data-testid":"assign-all-systems-toggle"})]})})]}),(0,b.jsx)(S.Z,{search:y,onChange:h,placeholder:"Search for systems","data-testid":"system-search",withIcon:!0}),(0,b.jsx)(P,{flowType:l,allSystems:F,dataFlowSystems:j,onChange:v})]})}),(0,b.jsx)(k.mz,{justifyContent:"flex-start",children:(0,b.jsxs)(p.hE,{size:"sm",children:[(0,b.jsx)(p.zx,{variant:"outline",mr:2,onClick:i,"data-testid":"cancel-btn",children:"Cancel"}),D?null:(0,b.jsx)(p.zx,{colorScheme:"primary",onClick:w,"data-testid":"confirm-btn",children:"Confirm"})]})})]})]})},Z=n(24753),z=n(6848),T=n(48466),A=n(51860);function V(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?V(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var I={dataFlowSystems:[]},L=function(e){var t=e.system,n=e.isIngress,i=e.isSystemTab,c=(0,l.pm)(),j=n?"Source":"Destination",v="".concat(j,"s"),k=(0,d.qY)(),C=(0,T.qQ)(),O=(0,o.Z)(C,1)[0];(0,T.K3)();var S=(0,z.C)(A.cS),_=(0,s.useMemo)((function(){var e=n?t.ingress:t.egress;e||(e=[]);var r=S?S.map((function(e){return e.fides_key})):[];return e.filter((function(e){return r.includes(e.fides_key)}))}),[n,t,S]),D=(0,s.useState)(_),P=D[0],V=D[1];(0,s.useEffect)((function(){V(_)}),[_]);var L=function(){var e=(0,a.Z)(u().mark((function e(r,s){var i,a,o,l;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.dataFlowSystems,a=s.resetForm,o=E(E({},t),{},{ingress:n?i:t.ingress,egress:n?t.egress:i}),e.next=5,O(o);case 5:l=e.sent,(0,y.D4)(l)?c((0,Z.Vo)("Failed to update data flows")):c((0,Z.t5)("".concat(v," updated"))),a({values:{dataFlowSystems:i}});case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return(0,b.jsxs)(r.Qd,{children:[(0,b.jsx)(r.KF,{height:"68px",paddingLeft:i?6:2,"data-testid":"data-flow-button-".concat(j),children:(0,b.jsxs)(f.kC,{alignItems:"center",justifyContent:"start",flex:1,textAlign:"left",children:[(0,b.jsx)(f.xv,{fontSize:"sm",lineHeight:5,fontWeight:"semibold",mr:2,children:v}),(0,b.jsx)(m.Vp,{ml:2,backgroundColor:"primary.400",borderRadius:"6px",color:"white",children:P.length}),(0,b.jsx)(f.LZ,{}),(0,b.jsx)(r.XE,{})]})}),(0,b.jsx)(r.Hk,{backgroundColor:"gray.50",padding:6,"data-testid":"data-flow-panel-".concat(j),children:(0,b.jsx)(f.Kq,{borderRadius:"md",backgroundColor:"gray.50","aria-selected":"true",spacing:4,"data-testid":"selected",children:(0,b.jsx)(g.J9,{initialValues:I,onSubmit:L,children:function(e){var n=e.isSubmitting,r=e.dirty,s=e.resetForm;return(0,b.jsxs)(g.l0,{children:[(0,b.jsx)(h.Gt,{id:"".concat(t.fides_key,":").concat(j),name:"".concat(j," Data Flow")}),(0,b.jsx)(p.zx,{colorScheme:"primary",size:"xs",width:"fit-content",onClick:k.onOpen,"data-testid":"assign-systems-btn",rightIcon:(0,b.jsx)(x.A5,{}),marginBottom:4,children:"Configure ".concat(v.toLocaleLowerCase())}),(0,b.jsx)(w,{systems:S,dataFlows:P,onDataFlowSystemChange:V}),(0,b.jsxs)(p.hE,{marginTop:6,children:[(0,b.jsx)(p.zx,{size:"sm",variant:"outline",disabled:!r&&P===_,onClick:function(){V(_),s({values:{dataFlowSystems:_}})},children:"Cancel"}),(0,b.jsx)(p.zx,{size:"sm",colorScheme:"primary",type:"submit",isLoading:n,disabled:!r&&P===_,"data-testid":"save-btn",children:"Save"})]}),k.isOpen?(0,b.jsx)(F,{currentSystem:t,systems:S,isOpen:k.isOpen,onClose:k.onClose,dataFlowSystems:P,onDataFlowSystemChange:V,flowType:j}):null]})}})})})]})},R=function(e){var t=e.system,n=e.isSystemTab;return(0,b.jsxs)(r.UQ,{allowToggle:!0,"data-testid":"data-flow-accordion",children:[(0,b.jsx)(L,{system:t,isIngress:!0,isSystemTab:n}),(0,b.jsx)(L,{system:t,isSystemTab:n})]})}},13861:function(e,t,n){"use strict";n.d(t,{R:function(){return F},Z:function(){return Z}});var r=n(34896),s=n(27378),i=n(14007),a=n(33571),o=n.n(a),c=n(24246),u=function(e){var t=e.columns,n=e.items,s=e.renderItem,a=(0,i.yo)(n,t);return(0,c.jsx)(r.xu,{children:a.map((function(e,n,i){var a=i.length;return(0,c.jsx)(r.xu,{className:o()["grid-row"],borderBottomWidth:a>1&&n===a-1&&e.length===t?"0.5px":void 0,children:(0,c.jsx)(r.MI,{columns:t,children:e.map((function(e){return(0,c.jsx)(r.xu,{className:o()["grid-item"],children:s(e)},JSON.stringify(e))}))})},JSON.stringify(e))}))})},l=n(44845),d=n(55732),f=n(97865),m=n(34707),p=n.n(m),y=n(21084),h=n(70409),x=n(29470),j=n(29549),v=n(5008),g=n(79894),b=n.n(g),w=n(86677),k=n(6848),C=n(55447),O=n(60709),S=n(78624),_=n(24753),D=n(51860),P=function(e){var t=e.system,n=(0,y.qY)(),s=n.isOpen,i=n.onOpen,a=n.onClose,o=(0,h.pm)(),u=(0,k.T)(),l=(0,w.useRouter)(),m=(0,D.DW)(),g=(0,f.Z)(m,1)[0],P=function(){var e=(0,d.Z)(p().mark((function e(){var n;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g(t.fides_key);case 2:n=e.sent,(0,S.D4)(n)?o((0,_.Vo)((0,S.e$)(n.error))):o((0,_.t5)("Successfully deleted system")),a();case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),F=""===t.name||null==t.name?t.fides_key:t.name;return(0,c.jsxs)(r.xu,{display:"flex","data-testid":"system-".concat(t.fides_key),children:[(0,c.jsx)(b(),{href:"".concat(O.So,"/configure/").concat(t.fides_key),passHref:!0,children:(0,c.jsxs)(r.xu,{flexGrow:1,p:4,"data-testid":"system-box",_hover:{cursor:"pointer"},children:[(0,c.jsx)(r.X6,{as:"h2",fontSize:"16px",mb:2,children:F}),(0,c.jsx)(r.xu,{color:"gray.600",fontSize:"14px",children:(0,c.jsx)(r.xv,{children:t.description})})]})}),(0,c.jsxs)(x.v2,{children:[(0,c.jsx)(x.j2,{as:j.hU,icon:(0,c.jsx)(v.nX,{}),"aria-label":"more actions",variant:"unstyled",size:"sm","data-testid":"more-btn",m:1}),(0,c.jsxs)(x.qy,{children:[(0,c.jsx)(x.sN,{onClick:function(){u((0,D.db)(t)),l.push("".concat(O.So,"/configure/").concat(t.fides_key))},"data-testid":"edit-btn",children:"Edit"}),(0,c.jsx)(x.sN,{onClick:i,"data-testid":"delete-btn",children:"Delete"})]})]}),(0,c.jsx)(C.Z,{isOpen:s,onClose:a,onConfirm:P,title:"Delete ".concat(F),message:(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(r.xv,{children:["You are about to permanently delete the system"," ",(0,c.jsx)(r.xv,{color:"complimentary.500",as:"span",fontWeight:"bold",children:F}),"."]}),(0,c.jsx)(r.xv,{children:"Are you sure you would like to continue?"})]})})]})},F=function(e,t){var n,r;return(null===(n=e.name)||void 0===n?void 0:n.toLocaleLowerCase().includes(t.toLocaleLowerCase()))||(null===(r=e.description)||void 0===r?void 0:r.toLocaleLowerCase().includes(t.toLocaleLowerCase()))},Z=function(e){var t=e.systems,n=(0,s.useState)(""),i=n[0],a=n[1],o=(0,s.useMemo)((function(){return t?t.filter((function(e){return F(e,i)})):[]}),[t,i]);return t&&t.length?(0,c.jsxs)(r.xu,{"data-testid":"system-management",children:[(0,c.jsx)(r.xu,{mb:4,"data-testid":"system-filters",children:(0,c.jsx)(l.Z,{search:i,onChange:a,maxWidth:"30vw",placeholder:"Search system name or description","data-testid":"system-search",withIcon:!0})}),(0,c.jsx)(u,{columns:3,items:o,renderItem:function(e){return(0,c.jsx)(P,{system:e})}})]}):(0,c.jsx)("div",{"data-testid":"empty-state",children:"No systems registered."})}},66090:function(e,t,n){"use strict";n.d(t,{Z:function(){return G}});var r=n(73679),s=n(90849),i=n(55732),a=n(97865),o=n(90089),c=n(34707),u=n.n(c),l=n(70409),d=n(34896),f=n(9992),m=n(29549),p=n(27378),y=n(78624),h=n(24753),x=n(51860),j=n(33167),v=n(62332),g=n(34090),b=n(88486),w=n(21084),k=n(5008),C=n(14275),O=n(68301),S=n(55447),_=n(43139),D=n(81918),P=n(24246),F=["customFieldValues"],Z=["onSubmit","initialValues","onDelete"];function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(Object(n),!0).forEach((function(t){(0,s.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var A=O.Ry().shape({data_categories:O.IX(O.Z_()).min(1,"Must assign at least one data category").label("Data categories"),data_use:O.Z_().required().label("Data use"),data_subjects:O.IX(O.Z_()).min(1,"Must assign at least one data subject").label("Data subjects")}),V={data_categories:[],data_subjects:[],data_use:"",dataset_references:[],customFieldValues:{},id:"",cookies:[]},E=function(e){e.customFieldValues;var t,n=(0,o.Z)(e,F);return T(T({},n),{},{name:null!==(t=e.name)&&void 0!==t?t:"",cookies:n.cookies.map((function(e){return{name:e,path:"/"}}))})},I=function(e){var t=e.allDataUses,n=e.allDataCategories,r=e.allDataSubjects,s=e.allDatasets,a=e.onDelete,o=e.privacyDeclarationId,c=e.includeCookies,l=e.includeCustomFields,f=(0,g.u6)(),p=f.dirty,y=f.isSubmitting,h=f.isValid,x=f.initialValues,j=(0,w.qY)(),v=s?s.map((function(e){var t;return{label:null!==(t=e.name)&&void 0!==t?t:e.fides_key,value:e.fides_key}})):[],b=function(){var e=(0,i.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a(E(x));case 2:j.onClose();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),k=""===x.data_use;return(0,P.jsxs)(d.Kq,{spacing:4,children:[(0,P.jsx)(_.AP,{id:"data_use",label:"Data use",name:"data_use",options:t.map((function(e){return{value:e.fides_key,label:e.fides_key}})),tooltip:"What is the system using the data for. For example, is it for third party advertising or perhaps simply providing system operations.",variant:"stacked",singleValueBlock:!0,isDisabled:!!o}),(0,P.jsx)(_.j0,{id:"name",label:"Processing Activity",name:"name",variant:"stacked",tooltip:"The personal data processing activity or activities associated with this data use.",disabled:!!o}),(0,P.jsx)(_.AP,{name:"data_categories",label:"Data categories",options:n.map((function(e){return{value:e.fides_key,label:e.fides_key}})),tooltip:"What type of data is your system processing? This could be various types of user or system data.",isMulti:!0,variant:"stacked"}),(0,P.jsx)(_.AP,{name:"data_subjects",label:"Data subjects",options:r.map((function(e){return{value:e.fides_key,label:e.fides_key}})),tooltip:"Whose data are you processing? This could be customers, employees or any other type of user in your system.",isMulti:!0,variant:"stacked"}),c?(0,P.jsx)(_.VT,{name:"cookies",label:"Cookies",options:[],isMulti:!0,variant:"stacked",isClearable:!1}):null,s?(0,P.jsx)(_.AP,{name:"dataset_references",label:"Dataset references",options:v,tooltip:"Referenced Dataset fides keys used by the system.",isMulti:!0,variant:"stacked"}):null,l?(0,P.jsx)(C.uc,{resourceType:D.P6.PRIVACY_DECLARATION,resourceFidesKey:o}):null,(0,P.jsxs)(m.hE,{size:"sm",display:"flex",justifyContent:"space-between",children:[(0,P.jsx)(m.zx,{variant:"outline",onClick:j.onOpen,disabled:k,"data-testid":"delete-btn",children:"Delete"}),(0,P.jsx)(m.zx,{type:"submit",colorScheme:"primary",disabled:!p||!h,isLoading:y,"data-testid":"save-btn",children:"Save"})]}),(0,P.jsx)(S.Z,{onConfirm:b,title:"Delete data use",message:"Are you sure you want to delete this data use? This action can't be undone.",isOpen:j.isOpen,onClose:j.onClose,isCentered:!0})]})},L=function(e){var t=e.onSubmit,n=e.initialValues,r=e.allDataUses,s=e.privacyDeclarationId,a=(0,C.mZ)({resourceType:D.P6.PRIVACY_DECLARATION,resourceFidesKey:s}),o=a.customFieldValues,c=a.upsertCustomFields,l=(0,p.useMemo)((function(){return function(e,t){var n,r;return e?T(T({},e),{},{customFieldValues:t||{},cookies:null!==(n=null===(r=e.cookies)||void 0===r?void 0:r.map((function(e){return e.name})))&&void 0!==n?n:[]}):V}(n,o)}),[n,o]),f=(0,p.useState)(!1),m=f[0],y=f[1],h=(0,p.useMemo)((function(){var e=r.filter((function(e){return e.fides_key===l.data_use}))[0];if(e)return l.name?"".concat(e.name," - ").concat(l.name):e.name}),[r,l]),x=function(){var e=(0,i.Z)(u().mark((function e(n,r){var s,i,a,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=n.customFieldValues,i=E(n),e.next=4,t(i,r);case 4:if(!(a=e.sent)){e.next=12;break}if(!((o=a.filter((function(e){return e.data_use===n.data_use&&(!e.name||e.name===n.name)}))).length>0)){e.next=10;break}return e.next=10,c({customFieldValues:s,fides_key:o[0].id});case 10:r.resetForm({values:n}),y(!0);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return{handleSubmit:x,renderHeader:function(e){var t=e.dirty,n=e.boxProps,r=e.hideSaved;return(0,P.jsxs)(d.xu,T(T({display:"flex",alignItems:"center",justifyContent:"space-between"},n),{},{children:[h?(0,P.jsx)(d.X6,{as:"h4",size:"xs",fontWeight:"medium",mr:4,children:h}):null,!r&&m&&!t&&l.data_use?(0,P.jsxs)(d.xv,{fontSize:"sm","data-testid":"saved-indicator",children:[(0,P.jsx)(k.St,{})," Saved"]}):null]}))},initialValues:l}},R=function(e){var t=e.onSubmit,n=e.initialValues,r=e.onDelete,s=(0,o.Z)(e,Z),i=L({onSubmit:t,initialValues:n,allDataUses:s.allDataUses,privacyDeclarationId:null===n||void 0===n?void 0:n.id}),a=i.handleSubmit,c=i.renderHeader,u=i.initialValues;return(0,P.jsx)(g.J9,{enableReinitialize:!0,initialValues:u,onSubmit:a,validationSchema:A,children:function(e){var t=e.dirty;return(0,P.jsxs)(g.l0,{children:[(0,P.jsx)(b.Gt,{id:"PrivacyDeclaration",name:"New Privacy Declaration"}),(0,P.jsxs)(d.Kq,{spacing:4,children:[(0,P.jsx)(d.xu,{"data-testid":"header",children:c({dirty:t})}),(0,P.jsx)(I,T({onDelete:r},s))]})]})}})},W=["privacyDeclaration","onEdit","onDelete","includeCustomFields","includeCookies"],M=["privacyDeclarations"];function U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?U(Object(n),!0).forEach((function(t){(0,s.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var H=function(e){var t=e.privacyDeclaration,n=e.onEdit,r=e.onDelete,s=e.includeCustomFields,i=e.includeCookies,a=(0,o.Z)(e,W),c=L(q({initialValues:t,onSubmit:function(e){return n(t,e)},privacyDeclarationId:t.id},a)),u=c.initialValues,l=c.renderHeader,f=c.handleSubmit;return(0,P.jsx)(v.Qd,{children:function(e){var n=e.isExpanded;return(0,P.jsx)(g.J9,{enableReinitialize:!0,initialValues:u,onSubmit:f,validationSchema:A,children:function(e){var o=e.dirty;return(0,P.jsxs)(g.l0,{"data-testid":"".concat(t.data_use,"-form"),children:[(0,P.jsx)(b.Gt,{id:"".concat(t.id,"-form"),name:t.id}),(0,P.jsxs)(v.KF,{py:4,borderBottomWidth:n?"0px":"1px",backgroundColor:n?"gray.50":void 0,"data-testid":"accordion-header-".concat(t.data_use),children:[l({dirty:o,boxProps:{flex:"1",textAlign:"left"},hideSaved:!n}),(0,P.jsx)(v.XE,{})]}),(0,P.jsx)(v.Hk,{backgroundColor:"gray.50",pt:0,children:(0,P.jsx)(d.Kq,{spacing:4,children:(0,P.jsx)(I,q({privacyDeclarationId:t.id,onDelete:r,includeCustomFields:s,includeCookies:i},a))})})]})}})}})},B=function(e){var t=e.privacyDeclarations,n=(0,o.Z)(e,M);return(0,P.jsx)(v.UQ,{allowToggle:!0,border:"transparent","data-testid":"privacy-declaration-accordion",children:t.map((function(e){return(0,P.jsx)(H,q({privacyDeclaration:e},n),e.id)}))})},N=["system","addButtonProps","includeCustomFields","includeCookies","onSave"];function K(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?K(Object(n),!0).forEach((function(t){(0,s.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var G=function(e){var t=e.system,n=e.addButtonProps,s=e.includeCustomFields,c=e.includeCookies,v=e.onSave,g=(0,o.Z)(e,N),b=(0,l.pm)(),w=(0,x.qQ)(),k=(0,a.Z)(w,1)[0],C=(0,p.useState)(!1),O=C[0],S=C[1],_=(0,p.useState)(void 0),D=_[0],F=_[1],Z=(0,p.useMemo)((function(){return D?t.privacy_declarations.filter((function(e){return e.id!==D.id})):t.privacy_declarations}),[D,t]),z=function(e){return Z.filter((function(t){return t.data_use===e.data_use&&t.name===e.name})).length>0&&(b((0,h.Vo)("A declaration already exists with that data use in this system. Please supply a different data use.")),!0)},T=function(){var e=(0,i.Z)(u().mark((function e(n,r){var s,i,a,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=n.map((function(e){var t;return Y(Y({},e),{},{name:null!==(t=e.name)&&void 0!==t?t:""})})),i=Y(Y({},t),{},{privacy_declarations:s}),a=function(e){if(!(0,j.isErrorResult)(e))return b.closeAll(),b((0,h.t5)(r?"Data use deleted":"Data use saved")),v&&v(e.data),e.data.privacy_declarations;var t=(0,y.e$)(e.error,"An unexpected error occurred while updating the system. Please try again.");b((0,h.Vo)(t))},e.next=5,k(i);case 5:return o=e.sent,e.abrupt("return",a(o));case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),A=function(){var e=(0,i.Z)(u().mark((function e(n,r){var s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.id===n.id||!z(r)){e.next=2;break}return e.abrupt("return",void 0);case 2:return s=t.privacy_declarations.map((function(e){return e.id===n.id?r:e})),e.abrupt("return",T(s));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),V=function(){var e=(0,i.Z)(u().mark((function e(t){var n,s,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!z(t)){e.next=2;break}return e.abrupt("return",void 0);case 2:return b.closeAll(),n=[].concat((0,r.Z)(Z),[t]),e.next=6,T(n);case 6:return(s=e.sent)&&(i=s.filter((function(e){return(!e.name||e.name===t.name)&&e.data_use===t.data_use}))[0],F(i)),e.abrupt("return",s);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),E=function(){var e=(0,i.Z)(u().mark((function e(n){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.privacy_declarations.filter((function(e){return e.id!==n.id})),e.abrupt("return",T(r,!0));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),I=function(){var e=(0,i.Z)(u().mark((function e(t){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E(t);case 2:return(n=e.sent)&&(S(!1),F(void 0)),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),L=t.privacy_declarations.length>0||0===t.privacy_declarations.length&&!O;return(0,p.useEffect)((function(){S(!1)}),[t.fides_key]),(0,P.jsxs)(d.Kq,{spacing:3,children:[(0,P.jsx)(B,Y({privacyDeclarations:Z,onEdit:A,onDelete:E,includeCustomFields:s,includeCookies:c},g)),O?(0,P.jsx)(d.xu,{backgroundColor:"gray.50",p:4,"data-testid":"new-declaration-form",children:(0,P.jsx)(R,Y({initialValues:D,onSubmit:V,onDelete:I,includeCustomFields:s,includeCookies:c},g))}):null,L?(0,P.jsx)(d.xu,{py:2,children:(0,P.jsx)(f.u,{label:"Add a Data Use",hasArrow:!0,placement:"top",isDisabled:0===Z.length,children:(0,P.jsx)(m.zx,Y(Y({colorScheme:"primary",size:"xs","data-testid":"add-btn",onClick:function(){S(!0),F(void 0)},disabled:O&&!D},n),{},{children:"Add a Data Use +"}))})}):null]})}},40397:function(e,t,n){"use strict";n.d(t,{f:function(){return c}});var r=n(6848),s=n(47134),i=n(75846),a=n(45128),o=n(75523),c=function(e){var t=e.includeDatasets,n=e.includeDisabled,c=(0,o.MO)().isLoading,u=(0,s.te)().isLoading,l=(0,i.fd)().isLoading,d=(0,a.LH)({onlyUnlinkedDatasets:!1},{skip:!t}).isLoading,f=(0,r.C)(o.qb),m=(0,r.C)(o.Bd),p=(0,r.C)(s.ZL),y=(0,r.C)(s.H7),h=(0,r.C)(i.U3),x=(0,r.C)(i.jp),j=(0,r.C)(a.Q4);return{allDataCategories:n?f:m,allDataSubjects:n?p:y,allDataUses:n?h:x,allDatasets:t?j:void 0,isLoading:c||u||l||d}}},33167:function(e,t,n){"use strict";n.d(t,{isAPIError:function(){return r.Bw},isErrorResult:function(){return r.D4}});var r=n(60041)},33571:function(e){e.exports={"grid-row":"BorderGrid_grid-row__gzSVf","grid-item":"BorderGrid_grid-item__7gUTW"}}}]);