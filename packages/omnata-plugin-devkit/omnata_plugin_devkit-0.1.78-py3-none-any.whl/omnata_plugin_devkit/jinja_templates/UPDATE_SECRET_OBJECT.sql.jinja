create or replace procedure PLUGIN.UPDATE_SECRET_OBJECT(SECRET_NAME VARCHAR,SECRET_CONTENTS VARCHAR)
   returns object
   language javascript
   execute as owner
as
$$
try{
   // this didn't work with IDENTIFIER syntax
   snowflake.createStatement( {
      sqlText: `alter secret ${SECRET_NAME} set SECRET_STRING = ?`,
      binds:[SECRET_CONTENTS]
   } ).execute();
   return {
      "success": true,
      "data": null
   }
}
catch(e){
   return {
      "success": false,
      "error": `UPDATE_SECRET_OBJECT: ${String(e)}`
   }
}
$$
;

grant usage on procedure PLUGIN.UPDATE_SECRET_OBJECT(VARCHAR,VARCHAR)
to application role OMNATA_MANAGEMENT;

