- name: Configure a multi node environment
  hosts: all
  tasks:
    - name: Set up multi-node firewall
      include_role:
        name: multi-node-firewall

    - name: Set up multi-node firewall
      include_role:
        name: multi-node-hosts-file

- hosts: launcher
  roles:
    - role: bindep
    - role: ensure-zookeeper
      zookeeper_use_tls: true
    - role: ensure-nox
  tasks:
    # NOTE(ianw) 2022-09-07 :
    # Shipped packages do not work and we need to use this statically
    # linked binary; see
    #  https://issues.redhat.com/browse/OCPBUGS-559
    - name: Ensure oc client is installed
      shell: |
          CLIENT=openshift-origin-client-tools-v3.11.0-0cbc58b-linux-64bit
          wget https://github.com/openshift/origin/releases/download/v3.11.0/${CLIENT}.tar.gz
          tar xvf ${CLIENT}.tar.gz
          sudo mv ${CLIENT}/oc /usr/local/bin
          sudo mv ${CLIENT}/kubectl /usr/local/bin
          oc version

- hosts: cluster
  roles:
    - ensure-openshift
