function se(e){let n=document.createElement("template");return n.innerHTML=e,document.importNode(n.content,!0)}function re(e){let n=document.createElementNS("http://www.w3.org/2000/svg","g");return n.innerHTML=e,n}var h=Object.assign(X(se,e=>{if(e.firstChild===null)return null;if(e.firstChild===e.lastChild)return e.removeChild(e.firstChild);let n=document.createElement("span");return n.appendChild(e),n}),{fragment:X(se,e=>e)}),tt=Object.assign(X(re,e=>e.firstChild===null?null:e.firstChild===e.lastChild?e.removeChild(e.firstChild):e),{fragment:X(re,e=>{let n=document.createDocumentFragment();for(;e.firstChild;)n.appendChild(e.firstChild);return n})}),xe=9,Ue=10,He=12,Be=13,Ie=32,Fe=65,Pe=90,Ge=97,je=122,B=60,E=62,g=47,_=45,W=33,Q=61,oe=34,ae=39,qe=63,T=1,le=2,ce=3,V=4,I=5,k=6,Y=7,F=8,P=9,J=10,Z=11,G=12,K=13,R=14,ue=15,de=16,A=17,fe=18,Te=19,pe=20,Ee=21,z=22,$=23,he=24,me=25,y=26,_e=27,ye=28,be=29,Xe=128,Ae=1,We=8,Qe=1,Ne="http://www.w3.org/2000/svg",v="http://www.w3.org/1999/xlink",we="http://www.w3.org/XML/1998/namespace",Se="http://www.w3.org/2000/xmlns/",Ce=new Map(["attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(e=>[e.toLowerCase(),e])),q=new Map([["xlink:actuate",v],["xlink:arcrole",v],["xlink:href",v],["xlink:role",v],["xlink:show",v],["xlink:title",v],["xlink:type",v],["xml:lang",we],["xml:space",we],["xmlns",Se],["xmlns:xlink",Se]]);function X(e,n){return function({raw:r}){let t=T,l="",p,u,f,c,m=0;for(let o=0,b=arguments.length;o<b;++o){let a=r[o];if(o>0){let i=arguments[o];switch(t){case y:{if(i!=null){let d=`${i}`;if(ve(u))l+=d.replace(/[<]/g,L);else{if(new RegExp(`</${u}[\\s>/]`,"i").test(l.slice(-u.length-2)+d))throw new Error("unsafe raw text");l+=d}}break}case T:{i==null||(i instanceof Node||typeof i!="string"&&i[Symbol.iterator]||/(?:^|>)$/.test(r[o-1])&&/^(?:<|$)/.test(a)?(l+="<!--::"+o+"-->",m|=Xe):l+=`${i}`.replace(/[<&]/g,L));break}case P:{t=G;let d;if(/^[\s>]/.test(a)){if(i==null||i===!1){l=l.slice(0,f-r[o-1].length);break}if(i===!0||(d=`${i}`)==""){l+="''";break}if(r[o-1].slice(f,c)==="style"&&ee(i)||typeof i=="function"){l+="::"+o,m|=Ae;break}}if(d===void 0&&(d=`${i}`),d==="")throw new Error("unsafe unquoted empty string");l+=d.replace(/^['"]|[\s>&]/g,L);break}case G:{l+=`${i}`.replace(/[\s>&]/g,L);break}case Z:{l+=`${i}`.replace(/['&]/g,L);break}case J:{l+=`${i}`.replace(/["&]/g,L);break}case k:{if(ee(i)){l+="::"+o+"=''",m|=Ae;break}throw new Error("invalid binding")}case A:break;default:throw new Error("invalid binding")}}for(let i=0,d=a.length;i<d;++i){let s=a.charCodeAt(i);switch(t){case T:{s===B&&(t=le);break}case le:{s===W?t=me:s===g?t=ce:j(s)?(p=i,u=void 0,t=V,--i):s===qe?(t=I,--i):(t=T,--i);break}case ce:{j(s)?(t=V,--i):s===E?t=T:(t=I,--i);break}case V:{N(s)?(t=k,u=U(a,p,i)):s===g?t=R:s===E&&(u=U(a,p,i),t=x(u)?y:T);break}case k:{N(s)||(s===g||s===E?(t=Y,--i):s===Q?(t=F,f=i+1,c=void 0):(t=F,--i,f=i+1,c=void 0));break}case F:{N(s)||s===g||s===E?(t=Y,--i,c=i):s===Q&&(t=P,c=i);break}case Y:{N(s)||(s===g?t=R:s===Q?t=P:s===E?t=x(u)?y:T:(t=F,--i,f=i+1,c=void 0));break}case P:{N(s)||(s===oe?t=J:s===ae?t=Z:s===E?t=x(u)?y:T:(t=G,--i));break}case J:{s===oe&&(t=K);break}case Z:{s===ae&&(t=K);break}case G:{N(s)?t=k:s===E&&(t=x(u)?y:T);break}case K:{N(s)?t=k:s===g?t=R:s===E?t=x(u)?y:T:(t=k,--i);break}case R:{s===E?t=T:(t=k,--i);break}case I:{s===E&&(t=T);break}case ue:{s===_?t=de:s===E?t=T:(t=A,--i);break}case de:{s===_?t=$:s===E?t=T:(t=A,--i);break}case A:{s===B?t=fe:s===_&&(t=z);break}case fe:{s===W?t=Te:s!==B&&(t=A,--i);break}case Te:{s===_?t=pe:(t=A,--i);break}case pe:{s===_?t=Ee:(t=$,--i);break}case Ee:{t=$,--i;break}case z:{s===_?t=$:(t=A,--i);break}case $:{s===E?t=T:s===W?t=he:s!==_&&(t=A,--i);break}case he:{s===_?t=z:s===E?t=T:(t=A,--i);break}case me:{s===_&&a.charCodeAt(i+1)===_?(t=ue,++i):(t=I,--i);break}case y:{s===B&&(t=_e);break}case _e:{s===g?t=ye:(t=y,--i);break}case ye:{j(s)?(p=i,t=be,--i):(t=y,--i);break}case be:{N(s)&&u===U(a,p,i)?t=k:s===g&&u===U(a,p,i)?t=R:s===E&&u===U(a,p,i)?t=T:j(s)||(t=y,--i);break}default:{t=void 0;break}}}l+=a}let w=e(l),D=document.createTreeWalker(w,m,null,!1),C=[];for(;D.nextNode();){let o=D.currentNode;switch(o.nodeType){case Qe:{let b=o.attributes;for(let a=0,i=b.length;a<i;++a){let{name:d,value:s}=b[a];if(/^::/.test(d)){let O=arguments[+d.slice(2)];ge(o,d),--a,--i;for(let M in O){let S=O[M];S==null||S===!1||(typeof S=="function"?o[M]=S:M==="style"&&ee(S)?ke(o[M],S):Ve(o,M,S===!0?"":S))}}else if(/^::/.test(s)){let O=arguments[+s.slice(2)];ge(o,d),--a,--i,typeof O=="function"?o[d]=O:ke(o[d],O)}}break}case We:{if(/^::/.test(o.data)){let b=o.parentNode,a=arguments[+o.data.slice(2)];if(a instanceof Node)b.insertBefore(a,o);else if(typeof a!="string"&&a[Symbol.iterator])if(a instanceof NodeList||a instanceof HTMLCollection)for(let i=a.length-1,d=o;i>=0;--i)d=b.insertBefore(a[i],d);else for(let i of a)i!=null&&b.insertBefore(i instanceof Node?i:document.createTextNode(i),o);else b.insertBefore(document.createTextNode(a),o);C.push(o)}break}}}for(let o of C)o.parentNode.removeChild(o);return n(w)}}function L(e){return`&#${e.charCodeAt(0).toString()};`}function j(e){return Fe<=e&&e<=Pe||Ge<=e&&e<=je}function N(e){return e===xe||e===Ue||e===He||e===Ie||e===Be}function ee(e){return e&&e.toString===Object.prototype.toString}function x(e){return e==="script"||e==="style"||ve(e)}function ve(e){return e==="textarea"||e==="title"}function U(e,n,r){return e.slice(n,r).toLowerCase()}function Ve(e,n,r){if(e.namespaceURI===Ne&&(n=n.toLowerCase(),n=Ce.get(n)||n,q.has(n))){e.setAttributeNS(q.get(n),n,r);return}e.setAttribute(n,r)}function ge(e,n){if(e.namespaceURI===Ne&&(n=n.toLowerCase(),n=Ce.get(n)||n,q.has(n))){e.removeAttributeNS(q.get(n),n);return}e.removeAttribute(n)}function ke(e,n){for(let r in n){let t=n[r];r.startsWith("--")?e.setProperty(r,t):e[r]=t}}async function te(e){let n=await e.json();if(e.status<200||e.status>299||!n.ok)throw Error(n.errors?n.errors.join(", "):"Unknown error");return n}async function De(e,n,r){return fetch(`/${e}/${n}/${r}/-/delete`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}}).then(te)}async function Oe(e,n,r,t){return fetch(`/${e}/${n}/${r}/-/update`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(te)}async function Le(e,n,r){return fetch(`/${e}/${n}/-/insert`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({row:r})}).then(te)}async function Me(e,n,r){return fetch(`/-/datasette-write-ui/edit-row-details?${new URLSearchParams({db:e,table:n,primaryKeys:r})}`).then(t=>t.json())}async function Re(e,n){return fetch(`/-/datasette-write-ui/insert-row-details?${new URLSearchParams({db:e,table:n})}`).then(r=>r.json())}var Ye=document.querySelector("script#datasette-write-ui-permissions"),H=JSON.parse(Ye.textContent),ne=class{constructor(){this.root=h`<div class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2 class="modal-title"></h2>
        <div class="modal-body"></div>
      </div>
    </div>`,document.body.appendChild(this.root),this.body=this.root.querySelector(".modal-body"),this.title=this.root.querySelector(".modal-title"),this.hide=this.hide.bind(this),this.show=this.show.bind(this),this.setTitle=this.setTitle.bind(this),this.setBody=this.setBody.bind(this),this.root.querySelector(".close").addEventListener("click",this.hide),document.addEventListener("keydown",n=>{n.key==="Escape"&&this.hide()})}hide(){return this.root.style.display="none",this}show(){return this.root.style.display="block",this}setTitle(n){return this.title.innerText=n,this}setBody(n){return this.body.innerHTML="",this.body.appendChild(n),this}},ie=class{constructor(n){this.hide=this.hide.bind(this),this.show=this.show.bind(this),this.toggle=this.toggle.bind(this),this.addButton=this.addButton.bind(this),this.root=h`<span class="row-icon">
      <button class="icon">&#9881;</button>
      <div class="menu"></div>
    </span>`,n.insertBefore(this.root,n.querySelector("a")),this.icon=this.root.querySelector(".icon"),this.menu=this.root.querySelector(".menu"),this.icon.addEventListener("click",r=>{r.stopPropagation(),this.toggle()}),document.addEventListener("click",this.hide),document.addEventListener("keydown",r=>{r.key==="Escape"&&this.hide()}),this.menu.addEventListener("click",r=>{r.stopPropagation()})}hide(){this.menu.style.display="none"}show(){this.menu.style.display="block"}toggle(){this.menu.style.display==="block"?this.hide():this.show()}addButton(n,r){return this.menu.appendChild(h`<button onClick=${r}>${n}</button>`),this}};function Je(e){return e.type==="int"||e.type==="float"||e.type==="INT"?h`<input
      type="number"
      value=${e.value}
      name=${e.key}
      id=${e.key}
      disabled=${!e.editable}
      step=${e.type==="int"?1:.01}
    />`:e.type==="str"||e.type=="TEXT"?h`<textarea
        name=${e.key}
        id=${e.key}
        disabled=${!e.editable}>${e.value}`:h`<p>Unsupported type ${e.type} for ${e.key}</p>`}function Ze(e){return e.affinity==="int"||e.affinity==="real"||e.affinity==="numeric"?h`<input
      type="number"
      name=${e.name}
      id=${e.name}
      step=${e.affinity==="int"?1:.01}
    />`:e.affinity=="text"?h`<textarea
        name=${e.name}
        id=${e.name}>`:h`<p>Unsupported type ${e.affinity} for ${e.name}</p>`}function Ke(e,n,r){return async function(){let l=await Me(e,n,r),p=new Map;function u(c){c.preventDefault();let m={};for(let[D,C]of p.entries()){if(C.disabled)continue;let o=C.type==="number"?C.valueAsNumber:C.value;m[D]=o}Oe(e,n,r,{update:m,return:!0}).then(()=>window.location.reload())}let f=h` <form onSubmit=${u}>
      <div>
        <div class="form-fields-container">
          ${l.fields.map(c=>{let m=Je(c);return p.set(c.key,m),h.fragment`
                <div> <label for=${c.key}>${c.key}</label> ${c.pk?"\u{1F511}":""} </div>
                <div> ${m} </div>
                `})}
        </div>
      </div>
      <input type="submit" value="Submit" />
    </form>`;$e.setBody(f).setTitle(`Editing ${e}/${n}/${r}`).show()}}function ze(e,n){return async function(){let{fields:t}=await Re(e,n),l=new Map;function p(f){f.preventDefault();let c={};for(let[m,w]of l.entries()){if(w.disabled)continue;let D=w.type==="number"?w.valueAsNumber:w.value;c[m]=D}Le(e,n,c).then(()=>window.location.reload())}let u=h` <form onSubmit=${p}>
      <div>
        <div class="form-fields-container">
          ${t.map(f=>{let c=Ze(f);return l.set(f.name,c),h.fragment`
                <div> <label for=${f.name}>${f.name}</label></div>
                <div> ${c} </div>
                `})}
        </div>
      </div>
      <input type="submit" value="Submit" />
    </form>`;$e.setBody(u).setTitle(`Inserting into ${e}/${n}`).show()}}function et(e,n,r){return function(){window.confirm(`Are you sure you want to delete ${e}/${n}/${r}?`)&&De(e,n,r).then(()=>window.location.reload())}}var $e=new ne;if(H.can_update||H.can_delete){let e=Array.from(document.querySelectorAll("table.rows-and-columns td.type-pk"));for(let n of e){let r=n.querySelector("a").getAttribute("href"),[t,l,p,u]=r.split("/"),f=new ie(n);if(H.can_update){let c=Ke(l,p,u);f.addButton("Edit",c)}if(H.can_delete){let c=et(l,p,u);f.addButton("Delete",c)}}}H.can_insert&&document.querySelector("#datasette-write-ui-insert-button").addEventListener("click",async()=>{let[n,r,t]=window.location.pathname.split("/");ze(r,t)()});
